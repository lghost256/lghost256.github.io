<!DOCTYPE html>
<html lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">Turn Linux into a Software Network Switch (L2 Bridging) | lghost256&#39;s blog</title>
<meta property="og:title" content="Turn Linux into a Software Network Switch (L2 Bridging) | lghost256&#39;s blog" />
<meta name="twitter:title" content="Turn Linux into a Software Network Switch (L2 Bridging) | lghost256&#39;s blog" />
<meta itemprop="name" content="Turn Linux into a Software Network Switch (L2 Bridging) | lghost256&#39;s blog" />
<meta name="application-name" content="Turn Linux into a Software Network Switch (L2 Bridging) | lghost256&#39;s blog" />
<meta property="og:site_name" content="lghost256&#39;s blog" />

<meta name="description" content="A guide to turn a Linux computer into a software switch.">
<meta itemprop="description" content="A guide to turn a Linux computer into a software switch." />
<meta property="og:description" content="A guide to turn a Linux computer into a software switch." />
<meta name="twitter:description" content="A guide to turn a Linux computer into a software switch." />

<meta property="og:locale" content="en" />
<meta name="language" content="en" />

  <link rel="alternate" hreflang="en" href="http://localhost:1313/posts/turn-linux-into-a-software-switch/" title="English" />





    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2025-06-19T00:00:00Z />
    <meta property="article:published_time" content=2025-06-19T00:00:00Z />
    <meta property="og:url" content="http://localhost:1313/posts/turn-linux-into-a-software-switch/" />

    
    <meta property="og:article:author" content="Carlos Angel" />
    <meta property="article:author" content="Carlos Angel" />
    <meta name="author" content="Carlos Angel" />
    
    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "Turn Linux into a Software Network Switch (L2 Bridging)",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2025-06-19",
        "description": "A guide to turn a Linux computer into a software switch.",
        "wordCount":  753 ,
        "mainEntityOfPage": "True",
        "dateModified": "2025-06-19",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "lghost256\u0027s blog"
        }
    }
    </script>


<meta name="generator" content="Hugo 0.147.8">

    
    <meta property="og:url" content="http://localhost:1313/posts/turn-linux-into-a-software-switch/">
  <meta property="og:site_name" content="lghost256&#39;s blog">
  <meta property="og:title" content="Turn Linux into a Software Network Switch (L2 Bridging)">
  <meta property="og:description" content="A guide to turn a Linux computer into a software switch.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-06-19T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-06-19T00:00:00+00:00">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Switches">


    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Turn Linux into a Software Network Switch (L2 Bridging)">
  <meta name="twitter:description" content="A guide to turn a Linux computer into a software switch.">


    

    <link rel="canonical" href="http://localhost:1313/posts/turn-linux-into-a-software-switch/">
    <link href="/style.min.2d921c18cf1ec555ffc03d59a8adc211c402c68c930c27d6a0c306ab175a8d09.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
</head>
<body data-theme = "dark" class="notransition">

<script src="/js/theme.js"></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title></title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        Home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link active" href="/posts/">
                        Posts
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/pages/about/">
                        About
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">Turn Linux into a Software Network Switch (L2 Bridging)</h1>
                
                
                
                <div class="post-meta">
                    <time datetime="2025-06-19T00:00:00&#43;00:00" itemprop="datePublished"> Jun 19, 2025 </time>
                </div>
                
            </header>
            
    
    <details class="toc" ZgotmplZ>
        <summary><b></b></summary>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#making-bridge-configurations-persistent-networkmanager">Making bridge configurations persistent (NetworkManager)</a></li>
  </ul>
</nav>
    </details>
            <div class="page-content">
                <h1 id="some-context">Some context</h1>
<p>A few weeks ago, I started building a lab in GNS3 to brush up on my intrusion detection skills. I installed Wazuh in my lab and its agent software on my endpoints and everything worked well. However, I quickly realized that I was missing an important part in my detection: network data. I decided I would use Suricata to gather this data, but ran into a small problem: virtual switches in GNS3 are helpful for forwarding L2 packets, but they lack advanced features such as port mirroring (which would allow me to forward packets to Suricata for logging). Without this function, I had to find an alternative solution so Suricata could sniff all the traffic on my network.</p>
<p>Using a hub was out of the question. I just don&rsquo;t like them. But that&rsquo;s when I had a hacky idea: what if I placed the Suricata server itself in the middle and used it as a network switch? All traffic would go through it, so traffic could be easily sniffed.  While this isn&rsquo;t a Suricata configuration guide, I <em>will</em> show you how I turned that Suricata server into a software switch. The process is simple to follow and it works just fine in a lab situation such as the one I described.</p>
<h1 id="configuration-steps">Configuration steps</h1>
<p><strong>NOTE</strong>: <em>I am using Rocky Linux 8 in this lab, which comes preinstalled with <code>NetworkManager</code>. While the steps for creating the software switch will not be affected by this, the steps for persisting configuration as well as the usage of <code>nmcli</code> is dependent on using <code>NetworkManager</code> for network configuration.</em></p>
<p>This is the topology I will be working with:</p>
<p><img src="/posts/Pasted_image_20250510200815.png" alt="Pasted_image_20250510200815.png"></p>
<p>As you can see, there are two hosts (<code>PC1</code> and <code>PC2</code>) and a connection to the Internet. Since GNS3 allows me to add as many NICs as I could possibly need in the click of a button, I added about 9 adapters to <code>Suricata</code>. I&rsquo;ve got 99 problems, but an Interface ain&rsquo;t one.</p>
<p>Now, we log into <code>Suricata</code> and create a brand new interface (in this case, <code>br0</code>):</p>
<pre tabindex="0"><code>ip link add name br0 type bridge
</code></pre><p>Bridge interfaces on Linux are useful because they:</p>
<ul>
<li><strong>Forward Ethernet frames</strong> between member interfaces (based on MAC learning).</li>
<li><strong>Learn</strong> which MACs live on which ports (interfaces).</li>
<li><strong>Drops or floods</strong> unknown/unreachable destinations.</li>
<li>Optionally supports:
<ul>
<li><strong>Spanning Tree Protocol (STP)</strong></li>
<li><strong>VLAN filtering</strong></li>
</ul>
</li>
</ul>
<p>Since I&rsquo;m not working with any VLANs and not dealing with STP in my lab environment, I will simply show how to add new members to this bridge interface, which will allow us to create a broadcast domain. Keep in mind that if you&rsquo;re working in a VLAN-aware environment, Linux bridges also support VLAN tagging and filtering via <code>bridge vlan</code> and <code>ip link</code>. For now though, we are going to add the interfaces in the topology shown above as members of <code>br0</code>:</p>
<pre tabindex="0"><code>sudo ip link set ens3 master br0    
sudo ip link set ens4 master br0
sudo ip link set ens10 master br0
</code></pre><p>Once that&rsquo;s done, we bring the interface up with:</p>
<pre tabindex="0"><code>ip link set br0 up
</code></pre><p>Finally, if we want <code>Suricata</code> to communicate on our IP network, which interface do we assign an IP address to? We simply use <code>br0</code>. In my case, assuming a <code>10.0.10.0/24</code> network, I used:</p>
<pre tabindex="0"><code>nmcli con mod &#34;br0&#34; \
ipv4.addresses &#34;10.0.10.50/24&#34; \
ipv4.gateway &#34;10.0.10.1&#34; \
ipv4.dns &#34;8.8.8.8&#34; \
ipv4.method &#34;manual&#34;
</code></pre><p>Remember that only the bridge interface (<code>br0</code>) should have an IP address — the slave interfaces (<code>ens3</code>, <code>ens4</code>, etc.) remain unconfigured at L3.</p>
<p>After following these steps, the bridge configuration is pretty much done&hellip; However, explicitly setting these parameters in configuration files would make me feel a lot safer. It would be a pain to have to re-execute those commands. If only there was a way&hellip; Oh wait, there <strong>is</strong> a way.</p>
<h2 id="making-bridge-configurations-persistent-networkmanager">Making bridge configurations persistent (NetworkManager)</h2>
<p>To make sure that changes are persistent, you can add some definitions to the <code>/etc/NetworkManager/system-connections/</code> directory (which contains files with the <code>nmconnection</code> extension).</p>
<p>First, I add a file named <code>br0.nmconnection</code> to make the bridge configuration persistent:</p>
<pre tabindex="0"><code>[connection]
id=br0
type=bridge
interface-name=br0
autoconnect=true

[bridge]
stp=false

[ipv4]
method=manual
address1=10.0.10.50
gateway=10.0.10.1
dns=10.0.10.1;8.8.8.8;

[ipv6]
method=ignore
</code></pre><p>And then, for each member interface, I create an <code>ensX.nmconnection</code> file (where <code>X</code> refers to the interface number). For example, <code>ens3.nmconnection</code> would look like this:</p>
<pre tabindex="0"><code>[connection]
id=ens3-slave
type=ethernet
interface-name=ens3
master=br0
slave-type=bridge
autoconnect=true
</code></pre><p>After adding configuration files for each member interface, change their permissions to <code>-rw-------</code>. Otherwise, <code>NetworkManager</code> will ignore these files:</p>
<pre tabindex="0"><code>chmod 600 /etc/NetworkManager/system-connections/*.nmconnection
</code></pre><p>With the bridge persistent across reboots, my <code>Suricata</code> instance can reliably monitor all traffic passing through the software switch.</p>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/lghost256" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
<a href="https://www.linkedin.com/in/cdangel" target="_blank" rel="noopener noreferrer me"
    title="Linkedin">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
    <rect x="2" y="9" width="4" height="12"></rect>
    <circle cx="4" cy="4" r="2"></circle>
</svg>
</a>
<a href="/index.xml" target="_blank" rel="noopener noreferrer me"
    title="Rss">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9" />
    <path d="M4 4a16 16 0 0 1 16 16" />
    <circle cx="5" cy="19" r="1" />
</svg>
</a>
</div>
    <small class="footer_copyright">
        © 2025 Carlos Angel.
        
    </small>
</footer><a href="#" title="" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    






    
    <script async src="http://localhost:1313/js/main.js" ></script>

    

</body>
</html>
